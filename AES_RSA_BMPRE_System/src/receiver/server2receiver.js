const PRE = require('./pre.js');
const fs = require('fs');
const readline = require('readline');
const mcl = require('mcl-wasm');
const mcl1 = require('mcl')
const prompt = require('prompt-sync')();

PRE.init({g: "The generator for G1", h:"The generator for G2", returnHex:false}).then(params => {

    const filePathB = 'D:\\Fan\\A bishe\\project\\PREKey\\B_key.txt';
    const filepath_reEnc = 'D:/Fan/A bishe/project/AES_RSA_BMPRE_System/src/server/reEnc.json';

    // 下面是从文件中读取B的私钥
    fs.readFile(filePathB, 'utf8', (err, data) => {
            if (err) {
                console.error("error:", err);
            }
            const [BprivateKeyString, BpublicKeyString] = data.trim().split('\n');
            const BprivateKeyHex = BprivateKeyString.split(':')[1].trim();

            // 读取reEnc.json
        fs.readFile(filepath_reEnc, 'utf8', (err, data) => {
            if (err) {
                console.log('出错啦：', err);
                return;
            }
            const reEnc = JSON.parse(data);


            const reEnc1 = reEnc.slice(0,2);
            //let reEnc1 = new Array('1acd8c867c88dd64e1e68fef69708f0a7332ff8a72c62031199568a4b1b02493eb8ed281459ee888c88afde6096d070fe9245f5ad684bb19bde6a3bef982b96dd8e81c6f77b6b7695827ead20d1ef01bd9e11180d81c7d4ea3b192846bbec20d1bcae2297bdf8feb7dabb2d7db06e5ccbd883482bf94c0d962c89abfd87bf2f8ee8a5c099a013b73527e5aeadb3c940f8cb13de5143cff89edccf7f94d428b28f3f2b7c39e347e6f513828b6d9903f2ef35b1eccbf1009ac4a7d8e54a3444801d930b4a3f2fabd35315800f606e573ebc80ceed9d6f90078d181380ccafc1125c63666afc5ab190b4d53dd89f807830b02a17e29ed090fce46d16a4a0c16e72690cf0d5130b8f5923887011cd7a73f25446dd3360852b513889812ea34cc950eb0a8e38bc8196b94da57cf9e1ddea6661993f394d22fa9edaa6a93a06331cabddfd7969a0f93925b9275097658b5e618e4c9c8c68110c83e2e52e42007ac655814f2358ab06dd175ec90ba0b172f73f6e52fb662666948f04b1cd5b7398ea60a366215ff13809f540658f01c7de5305de6aa10be98f0c69705368213a8d0730a7463a674dfd8d8efa66048f61abdec05d886ec8a331e23714160acbe10ecba269245f3ad5ed2388f384ffbadc32000b28a7111b0cfda8472df21d1e44575450f35c687dcb167bb0b18ca855962e1835a33b51f853cd243f441bd704110301c0449bbc08464c25e3a384f4266db1f6c1643c078af18e88f2912ef1d0da40e6ad9fdb9f5ebb012f296bb6511e1f60b0485a1afbae8963c05c43d8529887ba92406', 'fe475e2d9e1f50e222e1f7e076b0c8508908afa37fd3504db242610decb7fe53')
            const reDecrypted1 = PRE.reDec(reEnc1, BprivateKeyHex);

            const reEnc2 = reEnc.slice(2,4);
            //let reEnc2 = new Array('de18e3890ec9129c629a6cd95db231fa74ddd6707ff50c289293effc97cf832fb9c0ec4344fc222cdac1254a253d4e00ba0663ae5594fcd10ed39133801b88894a74d27e98f42a1a0ae4a5ad61edb2f68853736eddc548252f0a3d685f705709fea9023059243ea4228d915cb140689073c033fa442f1fc7a9a8709889dc15c53516d0c0372e4ba0c0e15ab711368a050847f8348058562340a0c9d5aadfb73e95fe2e6689601d638329f6c625dd9a78c328f75588662bf8bab4e59e8fd1d5030e40494d11ca1213573b0cdb4779d3b95bb4527308effee6e71297ea77a7afea24123de9f738eb7ab3762bf3a1addb045fa2277e392346cf25801672f437d7e04ae897125d1467159d6b26c9dc5637d443bc635bcbec4f036731d81e1087a2162c8adc46608350cbde078e14626ea2843e4a8442b6f3f9467d19fb7f730f4ba6291172e480910941e28ad225f6ebc508c730006f6d7e1e55a8947ecf158cf7e6432c783027e743defe7dfb14f052df36ac044dcef711a553286851efacd702138740cfc93324eecbeb87f00cbfb2cb3033eaf55c180dcf849bd88dbb44ce5aac958401f776550c1df1ca6f83b709fe137bca728ad968f2183e6d87e8d2cdc30e8b18445784bd1ba2b128ecf3e03812ff8cdd5a5306fbc07ebe34d3aff91e971662dd5aec7b984292b6e5fd8c093df9cd504f2cfd489ce5fb63b344a11136539ccb2be65771f99c353d2af849c604201578ee42141f651838e1aed9714107f7495cc8959857c0ef937e8d754beab465cf2c9fc06c361dc78cb181ae20084a2601', 'eee929d5250a8eb5d5b7a8602267b17d9d7fe33477be4d9d85d68a8551f0dc18')
            const reDecrypted2 = PRE.reDec(reEnc2, BprivateKeyHex);

            const reEnc3 = reEnc.slice(4,6);
            //let reEnc3 = new Array('5630514eb215c2bc78765332c8755d2f7f80ced04eb8fd7898208bf221754d3539ad744c9ca3647eae718743f8f0cb0ca99b199017adf946c7ce932a71d5e6c6781c3171029bf4497fa9c9f61e252305866d9190c7897567941043c508f5c712ee120521067d155f6393f16110b9accc2bb45f01f4eb9dcbd49eb6f97fb14b379ebec25dc7f76ef6bcc47188f50aeb04dcb875f4e3ef4323842ab0c9e53163a95f7a4472c9368b3e8ad90cb19c2f95244abe832e3bd40b61aa1e5618f06ad91150acdfb063e916d12a2ee211f6dc826a7b4ec111dfa033ded5e409da6de571376296683ed7c7b0ac47a439df19f3c419f87dd7663c1a1d578a138fdfcce9561c82da9a6d7303f256b3ba2eb3768c5bf102db85830f57d02759828b40b780520c29a2a979aa4bbd1cc0d8623b32aa9a1389f318ab8d497611ecbd2b654d769351ecfec4d32b696aed3c1c9a384a05e40858d2a98bb48a44fa246de6d56a8624019a9bee0983ed8807e2b351838460b989907abe4e7d594168b17b4b570c67ee14db673478a7e293249fcce86fcd09f86a0e06a38835c75f5660f6e646b4da7c970eea076ccd0fc8307f552ff4bec35c00bcbb1b6d568cc99c0209ca201f9606f8b5fcff3fc23dab60abd6cefc6c032aca04e62be0cc4f90aeb34d7f62089c230ed30a8919717ac5cd0516937fb473652b052c8c14d1a059384b4d0a950c53ada440cd9a0e3b71b78ce6d6fecda4b73a0bda918512c43a5572eea58f0d379bb137b8a8449829a577129ba3b9b5e69eaee872222bd9eb1ef70a6d6d643cedb19616', 'a0faf9ba5c6b44f4f79293d7bba9c80c279a0f854de9263141b3959cf3281e2a')
            const reDecrypted3 = PRE.reDec(reEnc3, BprivateKeyHex);

            const reEnc4 = reEnc.slice(6,8);
            //let reEnc4 = new Array('3833260b364e54890e7ea2fb3d2ec4a859684ecc0ae2e0fef9b62e6c86801d3764b79521f2b480c1eb8f94a1f7ae0111bbd8602294c131f044a6df99539e225f25a05d1a55f64aded9e82cdd7d3fb38c672f9b077954af0164bd41da4bfce8069e3b9ebada88baa9162299a6557dceca8ae156033f003e8025642d00ed13cd233aaebc7eccc7f7cbaddf54af9c4f490ecd12f7aa953cc69372667fc65d34afa45be6a1504238dcc62b0c514e725fe227fa72d09cc1d2ced0f95e5d7bdc39900202d8c9b8b3a2f55a4abb2b11f57e1d323526d39a021f168df9cf67857cb12a0194c33f1773403be22f37831d4149ca18423a5c81f3a4e4898f2bf18d5b4bbb1ed3b7b382cb280d0062983696445f5cc43a680303f2b4ba311ebed7274289590eb7f08d7769aeb791835104fdbc544fbbdf3036b31abac7e01bf51ae5903a6a3b6ba80ead80d54d697955f74c4f1813112cc0071e732749f75acb60fa417319c48c0e5389eac7d9c27cbe35282d6eb6ebaaa235fd56b6ca06e37cba10d668571775110295ae54d33ef83cfae842078823acea5d0f251a10bcb267d23a42fbac73d4163abdbaa09e82858e41ca9a3a3d149ba235e6855c2fafb2c0abc340825ddd2034c55a01fedff134cf75d6965d16b42fd7a6cebf31d6d3e47716f8faca1b077c10f96d554c94d5e7229e7599c16f9a3cb05de1f67d2a7d1d1b30d9b40c8857b1f76257e039b4ed4bfdfbf28f8add13eaa1e6b21193a29432d288f0e6b1de568935b61c5209424c4d5a3c92b7eeb872d02f3505203cf3857c9fd16b5432f611', 'd301588491512526a2660e1171c98e63a1c84fe44e996ec1879cdd130fa26f67')
            const reDecrypted4 = PRE.reDec(reEnc4, BprivateKeyHex);

            const reEnc5 = reEnc.slice(8,10);
            //let reEnc5 = new Array('d1a7a84e2e9f3db04caee6dc9642d5d223f64a8aeca67f82873b761375451ca5947a10984fe3c80bcd6b29a9629cfe18974e95225b74f2c113cf0492f83782a89d877708d2e551f088c52dc4ec178a5fd19a7a459376c0103ac0ef9eb24e15092c21a91a4aa54906edc7b93c3e267784d1e41e0dde7ff64c3b97a8696454db483f05e20a2f636e9cf639dde86698b8096b6bf43503a770e42aeaa5ba67ccb0d49d49c13bb1eb1c42a85f6ecf7e1c5b954723acdc4d6514d9d1cc1a5a3f6d6011c6ba40b15901d5b477007bc9107687b28e03e6d16534b89df4e1a9b94af57a3296dcc4880236e3bb0d46e2cfeb2dbd0f946cd35525054cd21992c3a6ff2007081abe314c261908813196ccbd2a56d577dd0ff5b0d04216fedae0dd8074d0e310dd9a27c8919a4fd62b9c57496c97bedb25857db550315b00de6645f002495aed2dad4b4c7844d931c33e161937294202a99fa793d36954780cee4ee815f5b09c622b1828476fba65e0d312675b805563c9c6637cc6bb60b4efd964c1468ea20a96cb9a1c7003ddbf15d9b2344f5b1bab1a2078e02646981873bc9dcf2faeac344c05081a41ec0f8267e7324bbfc4541819fbb67ee996866166a9c6ebabe0c193b9d140e1f7f7a46b8d11573156982d679a3ae648dd92bf51c952433514cac7160ac67b58369c9cec628e30150d6f99db31d4a2e5cb539d61fa55f7bb29c80a8fa1f7a51f5f6d5e1f841a4e3c1c6d210f00a7c1e34469c2429b2d7b5b7709e242cd36ef19b5ba8ce65852ea0c276840ba86d12c0ba7d887c187102e5d4979900b', '310880f6a2840904a0065988bcfdcada8f0219ab4d844a1be18e642b53404321')
            const reDecrypted5 = PRE.reDec(reEnc5, BprivateKeyHex);

            const reEnc6 = reEnc.slice(10,12);
           // let reEnc6 = new Array('af5b89d1955f3c26a9e96213d4a1b7fd958625df5ea3c1edde367cb34804dc284e37e386f21d52b8c9e6f9e74a7b5d109e18c7870de8187da8410b69833a4a58b0f824051bca3f0fc728f3bb0da324306d902b61bd3d723ec38fd66676e93f13338a3fde540a624969d1252d5bac72ee72d528b960e38362b83a86893b19eb6d5c964e0e9bf01bf30300050f2009f5110b1d4b2535fded10474c54d83bb44499ef395788337fa559e96fa8c459415dbcb496d0147ac5104dffb4a72d76d1e21469afdfc13e77b2474a91d869d684a9093b1c71335c9b8f84c3d09296e7ff5d80c5c3da0d75110135d1c9b45ddea0a11151a112003341d5c128c4afee7ea29d1bff1acbfcb565ce4db1ce2f1ee2ac6534d459a7c98f93684bd93589b0bb7c0202d6bcc17a83213467c4b8f47c8c494a26f041146e1d7884698a96edfbd62a473509d4c6588d9b8c022e7dd3df533efb0170bd87a6231974cae0a4c4299dc2891e66103d42fc070f0cafddaaf14a7d4ae6a7b6c0424475e4220f6da44d3f361602721fb21f89ec23266cef3674fe647c76fd5e9588819d9cd6137024899ee89be6192b461b28a0b8e028f7465675bc6307c6bacebe157c5e148879c65267b56b891bae98b8d04570f320c0d2f82cd3038be41ada36a6d54fb7e8b2367bb65b9116e5956792e7482bba3b9bcb1833256c583ac8c6cd49769f87455c68fef4684ee45127da725aae0141e4610baf7d6b871749db8214c7a74ed2242c5fc199de53e85888787098701eed4f269e44793f661630cf0c6ee2cc50ca0a8653dbbf69d704', '4b87b65ae7364b960e624d199a86f80cd386e04095dd7dc14b0e431cc02ea02c')
            const reDecrypted6 = PRE.reDec(reEnc6, BprivateKeyHex);

            const reEnc7 = reEnc.slice(12,14);
            //let reEnc7 = new Array('3e8afcaa1f4e4f8e8967579e9b5cce37f74140189be6616b8678f228d78a19976f3d6e53662d17e92327329fe7e9b70386783f4fd1f34b8ec10dca5fa8367c0022c9cd72e9f6b5a1eb062b74ecbe6fa27b3a76eb5995537f0d6ae96e0040300cb6a1b363ebc8b21c5b9f64cb27bcb725d3e90e5a530b323e26c7096ffbe00e6f08ed89c1fb6cf00a3baa0b8a5e2cb0013fdc72faa4cbe770e38ac828eebc8b80c59df07f5daaeb84174f72a06f598492ae2956f7b9ea5b29dac92153ace4d304f32db9067fb3fb1ad4021fad1f503fc93386126107ba0ead6990ce7d02afe2946cc7e35f30d67160235e2e3a5009b413d3a28bc8e8e4c8fda7dd83e37b5e042936a6ea03804347b0fa822b22150cee65d4b4e671f694924fe2944dc208d8270521ac90c0ccb9f08954d12e1c632a4f80390208ba2ff839c6852d1039d668ed370613f61b58404f68265647be074a89017e711f4e992918bd4347dd12346b1ac3f71d83fcd2b4e9530b80b4e9ce5b9e46bed4768277405222897de3bf6bba7001914c16943f86408911c4b86b8de7b1c004a003819f2305ed1cae870599f71dc90a2aa4b7b01e8077e89a3c5760f49906d332de2a93b2c3beff75c27cff9928142fafb0d413440eee358e8883c33657f2c2e9a637a0f1d1672be21a32f3e21919719812b9028d1dfd1c3aaf980cf81a1643c003b9b22a733d682f4c9b612b19da2a68331900de5488bd6ec18635bdca056677e19eefd7bca8cc4b8a90a940f4df9096f767808c6fa034e44f49f24f676e635ec7f34a96926a692252a5d0f9650c', 'fe8497a44194bcb9cd3fd846a1a6c3c08e6887080aab40de24ce7d5c6fc17210')
            const reDecrypted7 = PRE.reDec(reEnc7, BprivateKeyHex);

            const reEnc8 = reEnc.slice(14,16);
            //let reEnc8 = new Array('276333a59bc39cc19b86ea3e95f604acafca489d81352161f55f5b5d8cd94a3ff4965b786c9ded5e8a2097cfedc2460be460e70cf63d3403ed27000b1c055a9c6501a90bb747836d49472d4176828f18620e0695beaeaa35fc54f395f493d213773e59a5741ef68b2bffd6ce80dc89088f703f682ba04ab3b229088c9ef823dd31a6039c94e453cacf35858af56bd80463a9b6997c9fa9fa4cbedbe7d42e89c0dc31de94c5efc24522d56615bf08ccf27bcce0f07a3f908f29bf8ce16080d608bc3cb5eb53e7bc298855b83fb76f6875d9de00101ec305ab0de222bd0c70edbee3e5a383a2ef456fe71e2ed6939cff175279a61ef5b522d2fdccef54cab62d7d37b1c3a6e92009af38f63cc43a14c204b22a6f74b27079cbd566ba411d9822028b055401866c61d8f8eba55ba7671fc74891229085d55b0ebe219aa6e02ec1e8f3aac1b5f6014614298a275ed64b3400b43f0c107b03b2cfdc4732680fae99eb3b725750ed550404c9d7aaad838a43e042380fcce3df363a92fa469dfe5f4915a5b6bf7b41f2b4c0d838b1ae9232209d4835dcd976b5a765a79351d9768a8318a65434e8c61330f2c5b7863bcb9d4f16fcdb0e4facca9103b5cb9f3521180c99414bb240649ed5d38f95fc485f8bbaeb67733d93445ef496e24c97ae80c0a10060cc1776f4d5e802199057dd94a46211d5d925ba5dd4b6c21d0628236f3bd67c40748261c2f1f0f9a10c561adeeb900da47cc6eae602e541d4b7721f6e8d6a9506169f822fc702719daded9480a71aaabcc33c44755508c5a01efef3d371e312', '3a73dddd372e97040ffc29a1ec9b650c1496668834ebf66fdaa480d599a26a45')
            const reDecrypted8 = PRE.reDec(reEnc8, BprivateKeyHex);


            const decKey = reDecrypted1.slice(0, 32) + reDecrypted2.slice(0, 32) + reDecrypted3.slice(0, 32) + reDecrypted4.slice(0, 32) + reDecrypted5.slice(0, 32) + reDecrypted6.slice(0, 32) + reDecrypted7.slice(0, 32) + reDecrypted8.slice(0, 32);
            console.log("decKey为:", decKey);

            // decKey 保存路径
            const deKeyPath = 'D:\\Fan\\A bishe\\project\\DecFiles\\decKey.txt';
            fs.writeFile(deKeyPath, decKey, (err) => {
                if (err) {
                    console.error('写文件出错：', err);
                    return;
                }
                console.log('decKey文件写入成功！,路径为：', deKeyPath);
            });
        });


    });

        }).catch(err => {
    console.log(err)
});